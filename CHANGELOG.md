
История изменений проекта
=========================

17-08-2016
----------

17-08-2016
----------

17-08-2016
----------

17-08-2016
----------

17-08-2016
----------

17-08-2016
----------

17-08-2016
----------


17-08-2016
----------
решен вопрос с сертификатом (хром считает его недоверенным) (решено посредством дописывания
                                                             промежуточного .crt в корневой)
    *https://www.emaro-ssl.ru/blog/intermediate/
     http://stackoverflow.com/questions/19104215/node-js-express-js-chain-certificate-not-working
     https://www.emaro-ssl.ru/instructions/ssl-installation.php
     http://superuser.com/questions/644343/how-do-you-fix-an-incomplete-ssl-chain
    **https://globalsign.ssllabs.com/analyze.html?d=gdetus.io
    
Доделан rollback, чтобы после отката на предыдущую версию он заново запускал приложение через PM2.

Сделаны отдельные команды: старт\стоп программы на боевом сервере.

Деплой ставит программу "с кнопки" в IDE на боевой сервер (для задач: deploy, rollback, status)

разобраться с тем фактом, что файл shipitfile.js не игнорится при деплое, 
несмотря на опцию ignores: ['.git', 'shipitfile.js'] (задача считается решенной по причине того что
                                                      на данный момент фактически файл игнорируется)
                                                      
сделать папку node_modules общей для всех релизов     (решено другими средствами)                                                 


16-08-2016
----------
Сделан https-сервер на боевом сервере.

Прокостылены модальные окна индекса (технически реализовано правильно, но вместо
сссылок теперь стоят #на каждом адресе каждой ссылки)

Создан контроллер для карты, поставлена заглушка и первые тестовые метки (хардкожены)


14-08-2016
----------

выяснить, как сделать так, чтобы нода оставалась в АКТУАЛЬНОЙ версии после
каждого рестарта\деплоя системы на боевом сервере. на данный момент после каждого
рестарта приложения нода слетает на версию 5.хх. А актуальная установленая в
системе - 6.хх

**примечание: есть мнение, что по этому вопросу надо разбираться с nvm-ом
**так же есть мнение что для каждого юзера в системе версия ноды своя. и логично
смотреть от какого юзера запущен процесс деплоя, pm2 и какие права у этого юзера 
                                        (решено посредством отказа установки nvm
                                         на боевом сервере за отсутствием
                                         необходимости иметь разные версии ноды)

Решили устанавливать Node на боевом сервере по инструкции
https://nodejs.org/en/download/package-manager/#enterprise-linux-and-fedora




12-08-2016
----------
нужно доработать параметр isAlpha для того, чтобы можно было создавать и
     изменять ФИО с русского на английский и обратно, но при этом необходимо
     правило, запрещающее использование обоих алфавитов в одном и том же
     поле формы и при регистрации и при изменении своих данных в /edit (решено)
     
после запиливания всех правил валидации и проверок форм и данных необходимо
   оформить все всплывающие уведомления силами фреймворка              (решено)


09-08-2016
----------
определить требования к созданию паролей при восстановлении (в методе
User.generatePassword()) 
** длина пароля должна составлять: не менее 8 символов (числа, англ. буквы)
** включая минимум один спецсимвол вида (% * ] ` ~) и т.д.)            (решено)

найти/сделать метод при котором пользователь имеет адрес личной страницы вида
сайт.ру/юзер если он назначил себе useruri при регистрации (или впоследствии)
и адрес вида сайт.ру/id1 если useruri не назначен                      (решено)
     
Добавлены валидаторы: 
-- на символы и спецсимволы в формах имя\фамилия (индекс + edit)
-- на символы и спецсимволы в форме useruri(индекс + edit)
-- на сохранение пустых\незаполненных форм (индекс + edit)

Изменён формат даты в changelog'e

2016-08-09
----------

Валидаторы форм моделей выделены в отдельный модуль models/validators.
Добавлены два валидатора: на уникальность, по черному списку.

2016-08-04
----------

заголовок личной страницы = имени владельца страницы. заголовок личной страницы
другого пользователя должен быть равен имени и фамилии владельца страницы 
   (решено)
   
узнать какое поле в таблице пользователя должно быть для указания и хранения
дня\месяца\года рождения и каково должно быть название этого поля (решено)

Процедуру восстановления пароля надо доделать. Сейчас при восстановлении
высылается лишь хэш. (решено)

2016-08-03
----------

страница "edit":
проброс данных в формы (решено)
календарь возраста  (частично решено)

найти/сделать метод при котором пользователь имеет адрес личной страницы вида
сайт.ру/юзер если он назначил себе useruri при регистрации или впоследствии
и адрес вида сайт.ру/id1 если useruri не назначен (решено)

разрешить sudo только для команды pm2 (ALL=(ALL) NOPASSWD: ALL) (решено)

вкладка "digits" - решить вопросы вывода данных из бд на эту вьюху (решено)


2016-08-02
----------

Деплой делается от имени обычного пользователя.
Слушатель на 80-ом порту требует повышенных привилегий пользователя, поэтому запускаем программу (в частности PM2) через sudo.
Для повышения привилегий в файле /etc/sudoers делается правка:
`<логин пользователя> ALL=(ALL) NOPASSWD: ALL` чтобы sudo не запрашивал пароль.
Так как pm2 запускается с повышенными правами, то не забывать его всегда запускать с sudo (например, sudo pm2 logs).

*в итоговой версии необходимо создать системного пользователя, назначить ему необходимые права доступа и связать его учетную запись
 с управлением рм2. На данный момент эту роль выполняет учётная запись insomakarma, что неприемлимо с точки зрения классического
 подхода к безопасности систем (т.к. данная учетная запись является не системной, а пользовательской)

2016-08-01
----------

1)Восстановление пароля пользователя посредством почты (частично решено, см. прим. *1)

прим. *1 перенести технологию на собственный почтовый сервер

1.2) создать собственный почтовый сервер

2) Чекбокс в разделе "регистрация" делает доступной кнопку регистрации (решено)

3) Чекбокс в разделе "вход" запоминает сессию авторизованного пользователя (решено)

4) доработать стратегию паспорта remember-me:
4.1) Вместо generateToken использовать GUID (решено) (методом установки модуля github.com/broofa/node-uuid)
4.2) Хранить токены стратегии паспорта remember-me не в ОЗУ, а в таблице MySQL (решено)

5) вопрос шифрования паролей методом установки встроенного модуля crypto (соль, хэш и т.д.) (решено)

6) сделать скрипт для деплоя на боевой сервер (минимально необходимый для работы функционал: deploy, rollback) 
   (решено)

7) решить - стоит ли прописывать параметры запуска проекта на боевом сервере
    и на сервере разработки (use process.env.PORT as the port and process.env.IP
    as the host и т.д.) внутри файла package.json (решено, см. package.json)


*Если пользователь авторизован, то при заходе на главную его 
принудительно перебрасывает на /feed

